# LESSONSPARK USA - CONTINUATION PROMPT
**Date:** November 25, 2025
**Last Commit:** After rate limiting docs update

## PROJECT OVERVIEW
LessonSparkUSA is a Baptist Bible study lesson generator platform built with:
- Frontend: React/TypeScript on Lovable.dev
- Backend: Supabase (PostgreSQL)
- AI: Claude API via Supabase Edge Functions
- Deployment: Netlify (auto-deploy from GitHub main branch)

## ARCHITECTURE PRINCIPLES (NEVER VIOLATE)
1. **SSOT (Single Source of Truth)** - One authoritative source for each data type
2. **Frontend Drives Backend** - UI defines what users see, backend mirrors/follows
3. **Admin Controls SSOT** - Admin changes frontend constants, system follows
4. **Business Logic in TypeScript** - Not in database triggers/functions
5. **Operational Settings in Database** - Rate limits, feature flags (admin configures without deployment)

## CLAUDE DEBUGGING PROTOCOL (5 RULES)
1. Root-cause diagnosis BEFORE proposing solutions
2. Complete solutions over piecemeal fixes
3. Verify file changes before proceeding
4. Explicit permission required for code changes
5. Copy-paste ready PowerShell commands

## FILE UPDATE PROCESS
1. Present complete file contents
2. Provide PowerShell Set-Content command
3. Await user confirmation before next step
4. Build and test after changes

## COMPLETED PHASES
- Phase 1-7: Core Platform
- Phase 8: Theology Profiles
- Phase 9: Beta Feedback System (November 25, 2025)
  - Beta signup page (/beta-signup)
  - Feedback modal with 5-star rating
  - Auto-popup 3 sec after export (Copy, Print, PDF, DOCX)
  - Export buttons at TOP and BOTTOM of generated lesson
  - RLS security verified (7 policies total)
- Rate Limiting Feature (November 25, 2025)
  - 5 lessons per 24 hours for beta testers
  - Admin exempt from limits
  - Usage indicator: "X of 5 lessons used (resets in Y hours)"
  - Settings in app_settings table (admin configurable via Supabase)

## KEY DATABASE TABLES
- lessons: User-generated lessons
- profiles: User profiles with theology_profile_id
- beta_testers: Beta program signups (4 RLS policies)
- beta_feedback: User feedback (3 RLS policies)
- app_settings: Admin-configurable operational settings
  - beta_lesson_limit = 5
  - beta_limit_hours = 24

## KEY FILES
- PROJECT_MASTER.md: Master documentation
- src/constants/theologyProfiles.ts: Frontend SSOT for theology
- src/constants/ageGroups.ts: Frontend SSOT for age groups
- src/hooks/useRateLimit.ts: Rate limiting logic (admin exempt)
- src/hooks/useEnhanceLesson.ts: Lesson generation hook
- src/components/dashboard/EnhanceLessonForm.tsx: Main lesson form
- src/components/dashboard/LessonExportButtons.tsx: Export with onExport callback
- src/components/BetaFeedbackModal.tsx: Feedback collection modal
- src/pages/Dashboard.tsx: Main dashboard with 3-sec feedback trigger

## ADMIN UUID
b8708e6b-eeef-4ff5-9f0b-57d808ef8762

## LOCAL PATHS
- Project root: C:\Users\Lynn\lesson-spark-usa
- Master doc: C:\Users\Lynn\lesson-spark-usa\PROJECT_MASTER.md

## PRODUCTION URLS
- Site: https://lessonsparkusa.com
- Supabase: https://supabase.com/dashboard/project/hphebzdftpjbiudpfcrs
- Netlify: https://app.netlify.com/sites/lessonsparkusa/deploys
- GitHub: https://github.com/lynn75965/lesson-spark-usa

## USER PROFILE
Lynn is a 74-year-old retired Baptist minister with PhD from Southwestern Baptist Theological Seminary. Non-programmer who needs complete, copy-paste ready solutions. Christian values guide all work.

## INSTRUCTIONS FOR NEW CLAUDE SESSION
1. Read PROJECT_MASTER.md FIRST before any work
2. Follow Claude Debugging Protocol strictly
3. Ask permission before making code changes
4. Provide copy-paste ready PowerShell commands
5. Verify all changes before proceeding
